apiVersion: skaffold/v4beta6
kind: Config
build:
  artifacts:
    - image: glauth-demo
      sync:
        infer:
          - glauth/
      docker:
      platforms:
        - linux/amd64
  local:
    push: true
manifests:
  rawYaml:
    - deployments/kubectl/*
deploy:
  helm:
    releases:
      - name: cert-manager
        repo: https://charts.jetstack.io
        remoteChart: cert-manager
        setValues:
          installCRDs: true 


profiles:
  - name: postgresql
    requiresAllActivations: false
    patches:
    - op: remove
      path: /build/artifacts/0
    - op: remove
      path: /manifests/rawYaml/0
    deploy:
      helm:
        releases:
        - name: postgresql
          wait: false
          remoteChart: oci://registry-1.docker.io/bitnamicharts/postgresql
          valuesFiles: ["deployments/helm/postgresql/values.yaml"]

portForward:
  - resourceType: service
    resourceName: glauth
    namespace: default
    port: 3893
    localPort: 23893
  - resourceType: service
    resourceName: postgresql
    namespace: default
    port: 5432
    localPort: 15432
